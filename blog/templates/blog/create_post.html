{% extends 'blog/wrapper.html' %}
{% load static %}

{% block title %}
    <h1>
        {% if title %}
            Edit '{{ title }}'
        {% else %}
            Create New Post
        {% endif%}
    </h1>

    <h5>
        <div class="row">
            <small class="text-muted col-sm-6">
                Created {{ created_date }} by {{ author }}
                <!-- Y-m-d H:i:s -->
            </small>

            <small class="text-muted col-sm-6">
                {% if published_date %}
                    Published: {{ published_date }}
                {% endif %}

                {% if primary_key %}
                        <a data-toggle="tooltip" title="View Post" href="{% url 'view_post' primary_key=primary_key %}">
                            <svg class="bi bi-newspaper" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M0 2A1.5 1.5 0 0 1 1.5.5h11A1.5 1.5 0 0 1 14 2v12a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 0 14V2zm1.5-.5A.5.5 0 0 0 1 2v12a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 .5-.5V2a.5.5 0 0 0-.5-.5h-11z"/>
                                <path fill-rule="evenodd" d="M15.5 3a.5.5 0 0 1 .5.5V14a1.5 1.5 0 0 1-1.5 1.5h-3v-1h3a.5.5 0 0 0 .5-.5V3.5a.5.5 0 0 1 .5-.5z"/>
                                <path d="M2 3h10v2H2V3zm0 3h4v3H2V6zm0 4h4v1H2v-1zm0 2h4v1H2v-1zm5-6h2v1H7V6zm3 0h2v1h-2V6zM7 8h2v1H7V8zm3 0h2v1h-2V8zm-3 2h2v1H7v-1zm3 0h2v1h-2v-1zm-3 2h2v1H7v-1zm3 0h2v1h-2v-1z"/>
                            </svg>
                        </a>

                        <script>
                            // Enable the tooltip.
                            $(function () {
                                $('[data-toggle="tooltip"]').tooltip()
                            })
                        </script>
                    {% endif %}
            </small>
        </div>
    </h5>
{% endblock %}



{% block content %}
    <!-- Display the form. -->
    <form method="POST" class="post-form">{% csrf_token %}

        <!-- The title texbox. -->
        <div class="form-group row">
            <!--
                <label class="col-sm-2 col-form-label" for="id_title">
                    Title
                </label>
            -->
            <div class="col-sm-6">
                {{ form.title }}
            </div>
        </div>

        <!-- The content text area. -->
        <div class="form-group row">
            <div class="col-sm-12">
                {{ form.content }}
            </div>
        </div>

        <!-- The image selection. -->
        <div class="container-fluid">
            <div class="form-group row justify-content-center">

                {% for radio in form.image %}

                    {# A workaround used due to Django assigning a blank option when no default value is set. #}
                    {% if radio.choice_label != "---------" %}


                    <div class="col-sm-3">
                        {# Display a (hidden) radio button. #}
                        {{ radio.tag }}

                        <!-- Attach an image to the radio button. -->
                        <label for="{{ radio.id_for_label }}">
                            <img class="img-fluid rounded" src="{% static 'images/'|add:radio.choice_label %}" alt="Image for {{ radio.choice_label }}">
                        </label>
                    </div>

                    {% endif %}

                {% endfor %}
            </div>
        </div>

        <script>
            // Select the first element (this currently breaks the editor as it auto-selects the first on save).
            // option = document.getElementById("id_image_1");
            // option.checked  = true;
        </script>

        <!-- The option buttons. -->
        <div class="row justify-content-center">
            <!-- Save the current post. -->
            <div class="col-sm-6" style="margin-bottom: 1%;">
                <button name="save" type="submit" class="btn btn-block btn-info">
                    {% if published_date %}
                        Save & Update
                    {% else %}
                        Save
                    {% endif %}
                </button>
            </div>
            
            {% if published_date %}
                <div class="dropdown col-sm-3">
                    <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Publish Options
                    </button>

                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <button name="publish" type="submit" class="dropdown-item">Save & Re-Publish</button>
                        <button name="unpublish" type="submit" class="dropdown-item">Save & Un-Publish</button>
                    </div>
                </div>
            {% else %}
                <!-- Publish the current post. -->
                <div class="col-sm-6" style="margin-bottom: 1%;">
                    <button name="publish" type="submit" class="btn btn-primary btn-block">Publish</button>
                </div>
            {% endif %}

            </div>
        </div>
    </form>

{% endblock %}